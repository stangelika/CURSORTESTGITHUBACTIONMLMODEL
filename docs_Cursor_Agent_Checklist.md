# Cursor + MCP + ML Workstation — План перепроверки и доводки (для агента)

Цель: перепроверить всю установку, довести до “топовой” конфигурации Cursor с MCP для научной работы по ML (разработка/обучение моделей), и подготовить среду для длительных экспериментов (до 72 часов) с мониторингом и логированием, включая GitHub Actions (через self-hosted runner с GPU).

Дата целевой среды: 2025‑09‑18  
ОС: Windows 11 Pro  
Железо: 32 GB RAM, NVIDIA RTX 4060 (8 GB)  
Python: 3.11.4  
CUDA: 12.9  
Базовая структура: `S:\mr Lopata\` (см. ниже)

---

## 0) Режим работы агента

- Работать пошагово, отмечать каждый шаг как УСПЕШНО/НЕУСПЕШНО с краткой причиной.
- Не вносить деструктивные изменения без точки восстановления:
  - Перед правками — создать резервную копию изменяемых файлов в `S:\mr Lopata\backups\{YYYYMMDD_HHMM}\`.
- Все логи и отчёты писать в:
  - Логи: `S:\mr Lopata\logs\cursor-agent-setup-{YYYYMMDD_HHMM}.log`
  - Итоговый отчёт: `S:\mr Lopata\reports\cursor-agent-verify-{YYYYMMDD_HHMM}.md`
- При критических ошибках — остановиться, зафиксировать детали и предложить варианты исправления.

---

## 1) Верификация ОС, GPU, драйверов и CUDA

Задачи:
- Проверить, что установлены свежие драйверы NVIDIA; `nvidia-smi` доступна и видит RTX 4060 (8 GB).
- Сверить Driver Version и CUDA Version (ожидаемо: Driver ~577.00, CUDA 12.9).
- Проверить энергоплан: выставить “Максимальная производительность” (чтобы self-hosted runner/длительные джобы не засыпали).

Критерии приёмки:
- `nvidia-smi` показывает 8 GB VRAM, устройство активно, без ошибок.
- Вся информация сохранилась в лог и итоговый отчёт.

Подсказки:
- Путь к `nvidia-smi`: `C:\Program Files\NVIDIA Corporation\NVSMI\nvidia-smi.exe`

---

## 2) Cursor — обновление до “топовой” версии и включение MCP

Задачи:
- Убедиться, что установлена последняя версия Cursor (автообновление включено).
- MCP включён и доступен:
  - Проверить наличие и корректность признаков активации MCP (значки инструментов внизу окна Cursor, отсутствие ошибок вида “Tool not found”).
- Полный рестарт Cursor после изменения конфигов (закрыть все процессы, запустить от имени администратора, подождать 3–4 минуты).

Критерии приёмки:
- Последняя версия Cursor установлена (в логе указать номер версии).
- MCP активен, Context7 доступен через тестовый запрос: “Покажи примеры React хуков”.

---

## 3) Структура каталогов и доступы

Базовая структура (должна существовать):

```
S:\mr Lopata\
├── configs\         # Конфигурации Cursor/окружения
├── docs\            # Документация
├── reports\         # Отчёты
├── scripts\         # Скрипты (в т.ч. из этого плана)
├── system-audit\    # Системные файлы/история аудита
├── logs\            # Логи
├── backups\         # Резервные копии
├── temp\            # Временные файлы
└── .cursor\
    └── mcp\
        ├── servers.json
        ├── context7.json
        ├── github.json
        ├── filesystem.json
        ├── sqlite.json
        └── memory.json
```

Задачи:
- Проверить наличие директорий и прав записи.
- Если чего-то нет — создать.
- Все изменения/создания — логировать.

---

## 4) MCP сервера: проверка и доводка

Требуемые сервера:
- Context7 (HTTP, с API ключом)
- GitHub MCP (Docker)
- Filesystem (NPX/встроенный)
- SQLite (NPX)
- Memory (NPX)

Задачи:
- Проверить, что все JSON в `S:\mr Lopata\.cursor\mcp\` валидны.
- Context7: проверить, что API‑ключ прописан через переменные окружения (не хранить ключи в файлах).
- GitHub MCP:
  - Установить Docker (если отсутствует), убедиться, что сервис запущен.
  - Синхронизировать/обновить образ `ghcr.io/github/github-mcp-server:latest`.
  - Подготовить GitHub Personal Access Token (PAT) и прописать его в переменные окружения (см. секцию “Безопасность”).
  - Проверить доступность инструментария (issues/PRs/repos/actions и т.д.).
- Filesystem, SQLite, Memory: убедиться, что запускаются и видны в Cursor.

Критерии приёмки:
- Все 5 серверов видны в Cursor, нет ошибок инициализации.
- Для GitHub MCP — токен найден и проходит базовые операции (например, чтение списка репозиториев).

---

## 5) Python 3.11.4 и ML-стек: верификация и фиксация

Ожидается (уже установлено):
- Python 3.11.4
- NumPy 2.2.6 (совместимо с numba)
- PyTorch 2.5.1+cu121 (GPU работает)
- TensorFlow 2.20.0 (GPU включён; если потребуется — альтернативно DirectML)
- scikit-learn 1.7.2, pandas 2.3.2, matplotlib 3.10.6, jupyter 1.1.1

Задачи:
- Проверить наличие и версии через `python -c` проверки.
- Верифицировать CUDA в PyTorch: `torch.cuda.is_available()`, имя/кол-во устройств.
- Верифицировать GPU в TensorFlow: `tf.config.list_physical_devices('GPU')`.
- При необходимости — зафиксировать версии в `requirements.txt`/`pyproject.toml` в целевом репозитории исследований.

Критерии приёмки:
- И PyTorch, и TensorFlow видят GPU без ошибок.
- Отчёт содержит распечатки версий и видимых устройств.

---

## 6) Разработка и исследовательская работа: окружение

Задачи:
- Установить/проверить Jupyter Lab/Notebook, nbextensions (по необходимости).
- Настроить изоляцию окружений (рекомендуется: `uv`, `venv` или `conda` — по выбору пользователя; по умолчанию оставить текущую рабочую 3.11.4 среду).
- Подготовить базовый шаблон проекта экспериментов:
  - `src/`, `data/`, `experiments/`, `notebooks/`, `results/`, `models/`, `configs/`, `scripts/`
  - Простейшие примеры обучения PyTorch и TensorFlow.

Критерии приёмки:
- Можно запустить пример обучения на GPU и получить артефакты (лог/метрики/модель).

---

## 7) GitHub Actions для длительных (до 72ч) задач с мониторингом

ВАЖНО:
- GitHub‑hosted раннеры не предоставляют GPU. Для 72h GPU‑обучения нужен self‑hosted runner на локальной машине (эта же Windows 11 с RTX 4060) или на отдельном сервере.
- Настроить Windows‑службу для self‑hosted runner, чтобы он переживал перезагрузки и не засыпал (энергоплан — “Никогда не спать”).

Задачи:
- Подготовить self‑hosted runner в целевом репозитории (или общем). Метки: `self-hosted`, `windows`, `gpu`.
- Добавить пример workflow для длинного обучения (timeout 72h, сохранение логов и артефактов).
- Включить логирование GPU (NVML) во время запуска эксперимента.
- Настроить периодический upload артефактов (по завершении — обязательно; при необходимости — промежуточно через разбиение на джобы/чекпоинты).

Критерии приёмки:
- Runner зарегистрирован и Online.
- Пробный workflow стартует, видит GPU, пишет логи, создаёт артефакты.

---

## 8) Безопасность и секреты

Задачи:
- GitHub PAT: создать Fine‑grained токен со следующими правами (минимально по необходимости):
  - repo (включая Contents, Issues, Pull requests), workflow, read:org, discussions (по необходимости).
- Не хранить токены в открытом виде в репозитории или в файлах MCP. Использовать:
  - Переменные окружения Windows (`setx GITHUB_TOKEN ...`) и Secrets в Cursor/репозиториях.
- Проверить, что в логах секреты не утекли (мэтчинг по паттернам).

Критерии приёмки:
- Токены в переменных окружения, отсутствуют в plain‑text в репо/конфигах.
- Логи не содержат секреты.

---

## 9) Финальные тесты

- Перезапуск Cursor, проверка MCP значков, тестовый запрос к Context7.
- Быстрый тест PyTorch/TensorFlow на GPU.
- Пробный запуск GitHub Actions workflow на self‑hosted runner (dry‑run/короткая версия).
- Сбор итогового отчёта (полная информация: версии,passes/fails, ссылки на логи/артефакты).

---

## 10) Артефакты, которые нужно выдать по результатам

- `S:\mr Lopata\reports\cursor-agent-verify-{YYYYMMDD_HHMM}.md` — итоговый отчёт.
- Обновлённые/созданные файлы конфигурации (только без секретов).
- Workflow для длинных экспериментов (см. пример ниже).
- Скрипты проверки/мониторинга (см. примеры ниже).

---

# Примеры, которые можно сразу использовать

Ниже — готовые файлы, которые агент может положить в соответствующие директории и адаптировать.

1) Workflow GitHub Actions для длительного обучения (72 часа) на self‑hosted GPU runner.  
Положить в репозиторий с экспериментами: `.github/workflows/ml-long-run.yml`.  
Требования:
- Зарегистрированный self‑hosted runner с метками: `self-hosted`, `windows`, `gpu`.
- В корне репозитория: `requirements.txt` (или адаптировать шаг установки).

См. файл в ответе: `.github/workflows/ml-long-run.yml`.

2) Скрипт быстрой верификации локальной среды (PowerShell): `scripts\verify-setup.ps1`.  
Пишет результаты в `S:\mr Lopata\logs\`.  
См. файл в ответе: `scripts/verify-setup.ps1`.

---

## Подсказки по self‑hosted runner на Windows

- Создать runner в настройках репозитория (Settings → Actions → Runners → New self-hosted runner → Windows).
- Скачать пакет, распаковать, выполнить:
  - `config.cmd` (ввести URL репо и токен регистрации).
  - `run.cmd` (для разовой сессии) или
  - `svc install` и `svc start` (как служба Windows).
- Добавить метку `gpu` при конфигурации (или через UI/редактирование labels).
- Убедиться, что служба запущена и runner отображается “online”.

---

## Точки конфигурирования для агента (заполнить/проверить)

- [ ] Проверить и записать версию Cursor (например, 0.xx.yy).
- [ ] Проверить Docker Desktop версию, включить автозапуск.
- [ ] `GITHUB_TOKEN` (PAT) в переменных окружения пользователя.
- [ ] `CONTEXT7_API_KEY` в переменных окружения (уже есть).
- [ ] Проверить пути в `S:\mr Lopata\` и права записи.
- [ ] Перечень установленных Python пакетов (версии зафиксированы).
- [ ] Файл `requirements.txt`/`pyproject.toml` в целевом репозитории исследований.

---

## Мини‑тесты для отчёта (вставить вывод)

PyTorch (GPU):
```python
import torch
print("Torch:", torch.__version__)
print("CUDA available:", torch.cuda.is_available())
if torch.cuda.is_available():
    print("Device count:", torch.cuda.device_count())
    print("Device 0:", torch.cuda.get_device_name(0))
```

TensorFlow (GPU):
```python
import tensorflow as tf
print("TF:", tf.__version__)
print("GPUs:", tf.config.list_physical_devices('GPU'))
```

nvidia-smi:
```
"C:\Program Files\NVIDIA Corporation\NVSMI\nvidia-smi.exe"
```

---

## Troubleshooting (кратко)

- TensorFlow не видит GPU:
  - Проверить совместимость версии, рассмотреть `tensorflow-directml` на Windows как fallback.
  - Проверить конфликтующие DLL/CUDA paths.
- PyTorch не видит GPU:
  - Убедиться, что сборка с CUDA (cu121), переустановить точные колёса с сайта PyTorch.
- GitHub MCP не стартует:
  - Проверить Docker, образ, переменные окружения (PAT), сеть/прокси.
- Cursor не видит MCP:
  - Полный перезапуск, очистка кэша, валидация JSON, подождать 3–4 минуты после старта.

---

Успешная сдача — это подробный отчёт, подтверждающий, что:
- Cursor — последняя версия, MCP активен, 5 серверов работают.
- Python/ML стек стабилен и видит GPU.
- Repo содержит workflow для длительных экспериментов и self‑hosted runner “online”.
- Логи/артефакты хранятся и доступны.